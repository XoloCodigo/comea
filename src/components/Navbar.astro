---
// Importamos los enlaces de navegación desde la configuración central
import { NAV_LINKS } from "../consts";
import { Icon } from "astro-icon/components";
---

<nav
  class="fixed w-full z-50 glass transition-all duration-300"
  id="navbar"
  transition:persist
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      <!-- Logo -->
      <a
        href="#home"
        id="logo-link"
        class="flex-shrink-0 flex items-center group gap-3"
      >
        <div
          class="w-10 h-10 bg-comea-main text-white flex items-center justify-center rounded-full shadow-lg group-hover:scale-110 transition-transform duration-300"
        >
          <Icon name="fa6-solid:plane-up" />
        </div>
        <div class="flex flex-col">
          <span
            class="font-display font-bold text-xl leading-none text-comea-main dark:text-white tracking-tight"
            >COMEA</span
          >
          <span
            class="text-[10px] font-semibold tracking-wider text-slate-500 dark:text-slate-400 uppercase"
            >Educación Aeroespacial</span
          >
        </div>
      </a>

      <!-- Menú de Escritorio -->
      <div class="hidden lg:flex space-x-6 items-center">
        <!-- Generamos los enlaces dinámicamente usando .map() -->
        {
          NAV_LINKS.map((link) => (
            <a
              href={link.href}
              class="nav-link text-xs font-bold uppercase tracking-wide text-slate-600 dark:text-slate-300 hover:text-comea-light dark:hover:text-comea-tech transition-colors"
            >
              {link.name}
            </a>
          ))
        }
        <a
          href="#contacto"
          class="nav-link px-5 py-2.5 bg-comea-main text-white text-sm font-semibold rounded-lg shadow-lg shadow-blue-900/20 hover:bg-comea-light transition-all hover:-translate-y-0.5"
        >
          Contacto
        </a>

        <!-- Dark Mode Btn (Escritorio) -->
        <button
          id="theme-toggle"
          aria-label="Cambiar tema"
          class="w-10 h-10 rounded-full flex items-center justify-center bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-comea-tech"
        >
          <Icon name="fa6-solid:moon" class="dark:hidden text-slate-600" />
          <Icon
            name="fa6-solid:sun"
            class="hidden dark:block text-yellow-400"
          />
        </button>
      </div>

      <!-- Mobile Buttons Area -->
      <div class="lg:hidden flex items-center gap-3">
        <!-- Dark Mode Btn (Móvil) -->
        <button
          id="theme-toggle-mobile"
          aria-label="Cambiar tema móvil"
          class="w-10 h-10 rounded-full flex items-center justify-center bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:text-comea-main focus:outline-none"
        >
          <Icon name="fa6-solid:moon" class="dark:hidden" />
          <Icon
            name="fa6-solid:sun"
            class="hidden dark:block text-yellow-400"
          />
        </button>

        <!-- Hamburguesa -->
        <button
          id="mobile-menu-btn"
          class="text-slate-600 dark:text-slate-300 hover:text-comea-main p-2 focus:outline-none"
        >
          <Icon name="fa6-solid:bars" class="text-2xl" />
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden lg:hidden glass border-t border-slate-200 dark:border-slate-700 absolute w-full h-screen"
  >
    <div class="px-4 pt-2 pb-6 space-y-1">
      {
        NAV_LINKS.map((link) => (
          <a
            href={link.href}
            class="mobile-nav-link block px-3 py-4 border-b border-slate-100 dark:border-slate-800 text-lg font-medium hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
          >
            {link.name}
          </a>
        ))
      }
      <a
        href="#contacto"
        class="mobile-nav-link block px-3 py-3 mt-4 text-center rounded-md text-base font-bold bg-comea-main text-white"
      >
        Contacto
      </a>
    </div>
  </div>
</nav>

<script>
  function initNavbar() {
    const themeToggles = document.querySelectorAll(
      "#theme-toggle, #theme-toggle-mobile"
    );
    const mobileBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const navbar = document.getElementById("navbar");

    const handleLinkClick = (event) => {
      const targetId = event.currentTarget.getAttribute("href");
      if (targetId && targetId.startsWith("#")) {
        event.preventDefault();
        const targetElement = document.getElementById(targetId.substring(1));
        if (targetElement) {
          targetElement.scrollIntoView({ behavior: "smooth" });
        }
        if (mobileMenu && !mobileMenu.classList.contains("hidden")) {
          mobileMenu.classList.add("hidden");
        }
      }
    };

    document.querySelectorAll('a[href^="#"]').forEach((link) => {
      link.addEventListener("click", handleLinkClick);
    });

    themeToggles.forEach((btn) => {
      btn.addEventListener("click", () => {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
    });

    mobileBtn?.addEventListener("click", () => {
      mobileMenu?.classList.toggle("hidden");
    });

    const handleScroll = () => {
      if (window.scrollY > 10) {
        navbar?.classList.add("shadow-lg", "shadow-slate-900/5");
      } else {
        navbar?.classList.remove("shadow-lg", "shadow-slate-900/5");
      }
    };

    window.removeEventListener("scroll", handleScroll);
    window.addEventListener("scroll", handleScroll);
  }

  initNavbar();
  document.addEventListener("astro:after-swap", initNavbar);
</script>
